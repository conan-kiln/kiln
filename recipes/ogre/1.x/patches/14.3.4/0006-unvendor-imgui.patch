From 67d636955425fa3da225208e9686ca9173fc35b2 Mon Sep 17 00:00:00 2001
From: Martin Valgur <martin.valgur@gmail.com>
Date: Mon, 17 Mar 2025 10:19:33 +0200
Subject: [PATCH 6/6] unvendor imgui

---
 Components/Overlay/CMakeLists.txt | 55 ++-----------------------------
 1 file changed, 3 insertions(+), 52 deletions(-)

diff --git a/Components/Overlay/CMakeLists.txt b/Components/Overlay/CMakeLists.txt
index 41bd634..ac7ff8b 100644
--- a/Components/Overlay/CMakeLists.txt
+++ b/Components/Overlay/CMakeLists.txt
@@ -18,27 +18,7 @@ list(APPEND HEADER_FILES
   ${CMAKE_CURRENT_SOURCE_DIR}/include/OgreOverlay.i)
 file(GLOB SOURCE_FILES "${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp")
 
-if(OGRE_BUILD_COMPONENT_OVERLAY_IMGUI)
-  set(IMGUI_DIR "${PROJECT_BINARY_DIR}/imgui-1.91.2" CACHE PATH "")
-  if(NOT EXISTS ${IMGUI_DIR})
-    message(STATUS "Downloading imgui")
-    file(DOWNLOAD
-        https://github.com/ocornut/imgui/archive/v1.91.2.tar.gz
-        ${PROJECT_BINARY_DIR}/imgui.tar.gz)
-    execute_process(COMMAND ${CMAKE_COMMAND}
-        -E tar xf imgui.tar.gz WORKING_DIRECTORY ${PROJECT_BINARY_DIR})
-  endif()
-  list(APPEND SOURCE_FILES
-    ${IMGUI_DIR}/imgui.cpp
-    ${IMGUI_DIR}/imgui_draw.cpp
-    ${IMGUI_DIR}/imgui_tables.cpp
-    ${IMGUI_DIR}/imgui_widgets.cpp
-    ${IMGUI_DIR}/imgui_demo.cpp)
-  if(FREETYPE_FOUND)
-    set(IMGUI_ENABLE_FREETYPE TRUE)
-    list(APPEND SOURCE_FILES ${IMGUI_DIR}/misc/freetype/imgui_freetype.cpp)
-  endif()
-else()
+if(NOT OGRE_BUILD_COMPONENT_OVERLAY_IMGUI)
     list(REMOVE_ITEM SOURCE_FILES "${CMAKE_CURRENT_SOURCE_DIR}/src/OgreImGuiOverlay.cpp")
 endif()
 
@@ -63,37 +43,8 @@ elseif(UNIX)
 endif()
 
 if(OGRE_BUILD_COMPONENT_OVERLAY_IMGUI)
-  target_include_directories(OgreOverlay PUBLIC
-    PUBLIC "$<BUILD_INTERFACE:${IMGUI_DIR}>"
-    PRIVATE "$<BUILD_INTERFACE:${IMGUI_DIR}/misc/freetype>")
-
-  if(UNIX)
-    set_source_files_properties(${IMGUI_DIR}/misc/freetype/imgui_freetype.cpp PROPERTIES
-      COMPILE_FLAGS "-Wno-missing-declarations")
-
-    set_source_files_properties(${IMGUI_DIR}/imgui_widgets.cpp PROPERTIES
-      COMPILE_FLAGS "-Wno-cast-qual")
-    set_source_files_properties(${IMGUI_DIR}/imgui_draw.cpp PROPERTIES
-      COMPILE_FLAGS "-Wno-cast-qual")
-    set_source_files_properties(${IMGUI_DIR}/imgui.cpp PROPERTIES
-      COMPILE_FLAGS "-Wno-cast-qual -Wno-unused-variable")
-    set_source_files_properties(${IMGUI_DIR}/imgui_demo.cpp PROPERTIES
-      COMPILE_FLAGS "-Wno-cast-qual")
-    if (CMAKE_CXX_COMPILER_ID MATCHES "Clang")
-      set_property(SOURCE ${IMGUI_DIR}/misc/freetype/imgui_freetype.cpp
-        APPEND PROPERTY COMPILE_OPTIONS "-Wno-unknown-warning-option")
-    endif()
-  endif()
-
-  if(MINGW)
-    target_link_libraries(OgreOverlay PRIVATE imm32)
-  endif()
-
-  configure_file(${OGRE_TEMPLATES_DIR}/imconfig.h ${IMGUI_DIR}/imconfig.h)
-
-  list(APPEND HEADER_FILES
-    ${IMGUI_DIR}/imgui.h
-    ${IMGUI_DIR}/imconfig.h)
+  find_package(imgui REQUIRED CONFIG)
+  target_link_libraries(OgreOverlay PUBLIC imgui::imgui)
 endif()
 
 generate_export_header(OgreOverlay 
-- 
2.43.0

