From d8faaba8efc83b5f3efe0938eadfcc2353940495 Mon Sep 17 00:00:00 2001
From: Martin Valgur <martin.valgur@gmail.com>
Date: Sun, 5 Oct 2025 06:03:21 +0300
Subject: [PATCH 9/9] avoid overlinking

---
 src/cupoch/camera/CMakeLists.txt        |  4 ++++
 src/cupoch/collision/CMakeLists.txt     |  9 +++++++--
 src/cupoch/geometry/CMakeLists.txt      | 12 +++++++++---
 src/cupoch/imageproc/CMakeLists.txt     |  9 +++++++--
 src/cupoch/integration/CMakeLists.txt   |  9 ++++++++-
 src/cupoch/io/CMakeLists.txt            | 14 +++++++++++---
 src/cupoch/kinematics/CMakeLists.txt    | 12 +++++++++---
 src/cupoch/kinfu/CMakeLists.txt         | 10 +++++++---
 src/cupoch/knn/CMakeLists.txt           |  7 ++++++-
 src/cupoch/odometry/CMakeLists.txt      |  9 ++++++++-
 src/cupoch/planning/CMakeLists.txt      |  8 +++++++-
 src/cupoch/registration/CMakeLists.txt  |  9 ++++++++-
 src/cupoch/utility/CMakeLists.txt       | 15 ++++++++++++++-
 src/cupoch/visualization/CMakeLists.txt | 15 +++++++++++++--
 14 files changed, 118 insertions(+), 24 deletions(-)

diff --git a/src/cupoch/camera/CMakeLists.txt b/src/cupoch/camera/CMakeLists.txt
index ac19815..6f79fe2 100644
--- a/src/cupoch/camera/CMakeLists.txt
+++ b/src/cupoch/camera/CMakeLists.txt
@@ -1,2 +1,6 @@
 file(GLOB_RECURSE CAMERA_SOURCE_FILES "*.cpp")
 add_library(cupoch_camera ${CAMERA_SOURCE_FILES})
+target_link_libraries(cupoch_camera
+  PUBLIC
+    cupoch_utility
+)
diff --git a/src/cupoch/collision/CMakeLists.txt b/src/cupoch/collision/CMakeLists.txt
index 72e4274..3f68897 100644
--- a/src/cupoch/collision/CMakeLists.txt
+++ b/src/cupoch/collision/CMakeLists.txt
@@ -1,4 +1,9 @@
 file(GLOB_RECURSE COLLISION_SOURCE_FILES "*.cu")
 add_library(cupoch_collision ${COLLISION_SOURCE_FILES})
-target_link_libraries(cupoch_collision cupoch_geometry
-                      ${3RDPARTY_LIBRARIES})
\ No newline at end of file
+target_link_libraries(cupoch_collision
+  PUBLIC
+    cupoch_geometry
+    Eigen3::Eigen
+  PRIVATE
+    stdgpu::stdgpu
+)
diff --git a/src/cupoch/geometry/CMakeLists.txt b/src/cupoch/geometry/CMakeLists.txt
index 3c0912f..e19126a 100644
--- a/src/cupoch/geometry/CMakeLists.txt
+++ b/src/cupoch/geometry/CMakeLists.txt
@@ -1,5 +1,11 @@
 file(GLOB_RECURSE GEOMETRY_SOURCE_FILES "*.cu")
 add_library(cupoch_geometry ${GEOMETRY_SOURCE_FILES})
-target_link_libraries(cupoch_geometry cupoch_knn
-                      cupoch_camera
-                      ${3RDPARTY_LIBRARIES})
\ No newline at end of file
+target_link_libraries(cupoch_geometry
+  PUBLIC
+    cupoch_utility
+    cupoch_camera
+    cupoch_knn
+    Eigen3::Eigen
+  PRIVATE
+    stdgpu::stdgpu
+)
diff --git a/src/cupoch/imageproc/CMakeLists.txt b/src/cupoch/imageproc/CMakeLists.txt
index a737841..d1c0b4c 100644
--- a/src/cupoch/imageproc/CMakeLists.txt
+++ b/src/cupoch/imageproc/CMakeLists.txt
@@ -1,4 +1,9 @@
 file(GLOB_RECURSE IMAGEPROC_SOURCE_FILES "*.cpp")
 add_library(cupoch_imageproc ${IMAGEPROC_SOURCE_FILES})
-target_link_libraries(cupoch_imageproc cupoch_geometry
-                      ${3RDPARTY_LIBRARIES})
\ No newline at end of file
+target_link_libraries(cupoch_imageproc
+  PUBLIC
+    cupoch_geometry
+    libsgm::libsgm
+  PRIVATE
+    cupoch_utility
+)
diff --git a/src/cupoch/integration/CMakeLists.txt b/src/cupoch/integration/CMakeLists.txt
index e77428b..0c59541 100644
--- a/src/cupoch/integration/CMakeLists.txt
+++ b/src/cupoch/integration/CMakeLists.txt
@@ -3,4 +3,11 @@ file(GLOB_RECURSE ALL_CUDA_SOURCE_FILES "*.cu")
 
 # create object library
 add_library(cupoch_integration ${ALL_CUDA_SOURCE_FILES})
-target_link_libraries(cupoch_integration cupoch_geometry)
\ No newline at end of file
+target_link_libraries(cupoch_integration
+  PUBLIC
+    cupoch_camera
+    cupoch_geometry
+  PRIVATE
+    cupoch_utility
+    stdgpu::stdgpu
+)
diff --git a/src/cupoch/io/CMakeLists.txt b/src/cupoch/io/CMakeLists.txt
index a815554..ec7174b 100644
--- a/src/cupoch/io/CMakeLists.txt
+++ b/src/cupoch/io/CMakeLists.txt
@@ -4,6 +4,14 @@ set(IO_ALL_SOURCE_FILES ${IO_CPP_SOURCE_FILES} ${IO_CUDA_SOURCE_FILES})
 
 # Create object library
 add_library(cupoch_io ${IO_ALL_SOURCE_FILES})
-target_link_libraries(cupoch_io cupoch_geometry
-                      cupoch_utility
-                      ${3RDPARTY_LIBRARIES})
\ No newline at end of file
+target_link_libraries(cupoch_io
+  PUBLIC
+    cupoch_geometry
+    cupoch_utility
+  PRIVATE
+    JPEG::JPEG
+    PNG::PNG
+    liblzf::liblzf
+    rply::rply
+    tinyobjloader::tinyobjloader
+)
diff --git a/src/cupoch/kinematics/CMakeLists.txt b/src/cupoch/kinematics/CMakeLists.txt
index 7f4bc2c..4fa4588 100644
--- a/src/cupoch/kinematics/CMakeLists.txt
+++ b/src/cupoch/kinematics/CMakeLists.txt
@@ -2,6 +2,12 @@ file(GLOB_RECURSE KINEMATICS_SOURCE_FILES "*.cpp")
 
 # Create object library
 add_library(cupoch_kinematics ${KINEMATICS_SOURCE_FILES})
-target_link_libraries(cupoch_kinematics cupoch_collision
-                      cupoch_utility
-                      ${3RDPARTY_LIBRARIES})
\ No newline at end of file
+target_link_libraries(cupoch_kinematics
+  PUBLIC
+    cupoch_collision
+    urdfdom::urdfdom
+  PRIVATE
+    cupoch_geometry
+    cupoch_io
+    cupoch_utility
+)
diff --git a/src/cupoch/kinfu/CMakeLists.txt b/src/cupoch/kinfu/CMakeLists.txt
index 470d32a..3a66d4d 100644
--- a/src/cupoch/kinfu/CMakeLists.txt
+++ b/src/cupoch/kinfu/CMakeLists.txt
@@ -2,6 +2,10 @@ file(GLOB_RECURSE KINFU_SOURCE_FILES "*.cpp")
 
 # Create object library
 add_library(cupoch_kinfu ${KINFU_SOURCE_FILES})
-target_link_libraries(cupoch_kinfu cupoch_integration
-                      cupoch_registration
-                      ${3RDPARTY_LIBRARIES})
\ No newline at end of file
+target_link_libraries(cupoch_kinfu
+  PUBLIC
+    cupoch_camera
+    cupoch_geometry
+    cupoch_integration
+    cupoch_registration
+)
diff --git a/src/cupoch/knn/CMakeLists.txt b/src/cupoch/knn/CMakeLists.txt
index 92ee423..8aadafd 100644
--- a/src/cupoch/knn/CMakeLists.txt
+++ b/src/cupoch/knn/CMakeLists.txt
@@ -3,4 +3,9 @@ file(GLOB_RECURSE ALL_CUDA_SOURCE_FILES "*.cu")
 
 # create object library
 add_library(cupoch_knn ${ALL_CUDA_SOURCE_FILES})
-target_link_libraries(cupoch_knn cupoch_utility)
\ No newline at end of file
+target_link_libraries(cupoch_knn
+  PUBLIC
+    cupoch_utility
+    Eigen3::Eigen
+    flann::flann_cuda
+)
diff --git a/src/cupoch/odometry/CMakeLists.txt b/src/cupoch/odometry/CMakeLists.txt
index fa5cd44..a1887c0 100644
--- a/src/cupoch/odometry/CMakeLists.txt
+++ b/src/cupoch/odometry/CMakeLists.txt
@@ -3,4 +3,11 @@ file(GLOB_RECURSE ALL_CUDA_SOURCE_FILES "*.cu")
 
 # create object library
 add_library(cupoch_odometry ${ALL_CUDA_SOURCE_FILES})
-target_link_libraries(cupoch_odometry cupoch_geometry)
\ No newline at end of file
+target_link_libraries(cupoch_odometry
+  PUBLIC
+    cupoch_camera
+    cupoch_geometry
+    cupoch_utility
+  PRIVATE
+    Eigen3::Eigen
+)
diff --git a/src/cupoch/planning/CMakeLists.txt b/src/cupoch/planning/CMakeLists.txt
index 4334a43..a1a5b13 100644
--- a/src/cupoch/planning/CMakeLists.txt
+++ b/src/cupoch/planning/CMakeLists.txt
@@ -1,3 +1,9 @@
 file(GLOB_RECURSE ALL_CUDA_SOURCE_FILES "*.cu")
 add_library(cupoch_planning ${ALL_CUDA_SOURCE_FILES})
-target_link_libraries(cupoch_planning cupoch_collision)
\ No newline at end of file
+target_link_libraries(cupoch_planning
+  PUBLIC
+    cupoch_geometry
+  PRIVATE
+    cupoch_collision
+    cupoch_utility
+)
diff --git a/src/cupoch/registration/CMakeLists.txt b/src/cupoch/registration/CMakeLists.txt
index 01f5d58..a836819 100644
--- a/src/cupoch/registration/CMakeLists.txt
+++ b/src/cupoch/registration/CMakeLists.txt
@@ -1,3 +1,10 @@
 file(GLOB_RECURSE ALL_CUDA_SOURCE_FILES "*.cu")
 add_library(cupoch_registration ${ALL_CUDA_SOURCE_FILES})
-target_link_libraries(cupoch_registration cupoch_geometry)
\ No newline at end of file
+target_link_libraries(cupoch_registration
+  PUBLIC
+    cupoch_knn
+    cupoch_utility
+    cupoch_geometry
+    stdgpu::stdgpu
+    Eigen3::Eigen
+)
diff --git a/src/cupoch/utility/CMakeLists.txt b/src/cupoch/utility/CMakeLists.txt
index e1f1632..65cefe0 100644
--- a/src/cupoch/utility/CMakeLists.txt
+++ b/src/cupoch/utility/CMakeLists.txt
@@ -1,4 +1,17 @@
 file(GLOB_RECURSE ALL_CPP_SOURCE_FILES "*.cpp")
 file(GLOB_RECURSE ALL_CUDA_SOURCE_FILES "*.cu")
 add_library(cupoch_utility ${ALL_CUDA_SOURCE_FILES} ${ALL_CPP_SOURCE_FILES})
-target_link_libraries(cupoch_utility ${3RDPARTY_LIBRARIES})
\ No newline at end of file
+target_link_libraries(cupoch_utility
+  PUBLIC
+    dlpack::dlpack
+    Eigen3::Eigen
+    JsonCpp::JsonCpp
+    spdlog::spdlog
+    stdgpu::stdgpu
+  PRIVATE
+    OpenGL::GL
+)
+if(USE_RMM)
+  find_package(rmm REQUIRED)
+  target_link_libraries(cupoch_utility PUBLIC rmm::rmm)
+endif()
diff --git a/src/cupoch/visualization/CMakeLists.txt b/src/cupoch/visualization/CMakeLists.txt
index ab24503..47ddd7f 100644
--- a/src/cupoch/visualization/CMakeLists.txt
+++ b/src/cupoch/visualization/CMakeLists.txt
@@ -26,5 +26,16 @@ file(GLOB_RECURSE VISUALIZATION_CUDA_SOURCE_FILES "*.cu")
 
 # create object library
 add_library(cupoch_visualization ${VISUALIZATION_CUDA_SOURCE_FILES} ${VISUALIZATION_CPP_SOURCE_FILES})
-target_link_libraries(cupoch_visualization cupoch_geometry cupoch_io cupoch_camera ${3RDPARTY_LIBRARIES})
-add_dependencies(cupoch_visualization shader_file_target)
\ No newline at end of file
+add_dependencies(cupoch_visualization shader_file_target)
+target_link_libraries(cupoch_visualization
+  PUBLIC
+      cupoch_camera
+      cupoch_geometry
+      cupoch_utility
+      Eigen3::Eigen
+      GLEW::GLEW
+      glfw
+  PRIVATE
+      cupoch_io
+      imgui::imgui
+)
-- 
2.43.0

